function API_kiala(dest,DSPID,country,street,localite,bckUrl){

	$('<iframe>', {
		src: 'http://locateandselect.kiala.com/searchsleek?dspid='+DSPID+'&country='+country+'&language=FR&preparationdelay=2&street='+street+'&zip='+localite+'&bckUrl='+bckUrl+'&target=_parent&list=open',
		id:  'iframe_kiala',
		width:'890', 
		height:'537',
		frameborder: 0,
		scrolling: 'no'
		}).appendTo(dest);
}

function _API_mondial_relay(dest){

	$('<iframe>', {
		src: 'http://lightyourscents.be/views/mondial_relay/mondial_relay_fr.php',
		id:  'iframe_mondial_relay',
		width:'900', 
		height:'590',
		frameborder: 0,
		scrolling: 'no'
		}).appendTo(dest);
}

function API_mondial_relay(dest,iso,localite){
	


	$(dest).MR_ParcelShopPicker({  
		Target: "#Target_Widget"                                // Selecteur JQuery de l'Ã©lÃ©ment dans lequel sera renvoyÃ© l'ID du Point Relais sÃ©lectionnÃ© (gÃ©nÃ©ralement un champ input hidden)  
		, TargetDisplay: "#TargetDisplay_Widget"                // Selecteur JQuery de l'Ã©lÃ©ment dans lequel sera renvoyÃ© l'ID du Point Relais sÃ©lectionnÃ© (secondaire pour affichage)  
		, TargetDisplayInfoPR: "#TargetDisplayInfoPR_Widget"    // Selecteur JQuery de l'Ã©lÃ©ment dans lequel seront renvoyÃ© les coordonnÃ©es complÃ¨tes de la selection de l'utilisateur  
		, Brand: "ECBE0431"                                     // Le code client Mondial Relay  
																// Lorsqu'il est indiquÃ© "BDTEST  ", un message d'avertissement apprait pour avertir que ce sont les paramÃ¨tres de test qui sont utilisÃ©s  
		, Country: iso                                         // Code ISO 2 lettres du pays utilisÃ© pour la recherche  
		,AllowedCountries: iso                           // Liste des pays selectionnable par l'utilisateur pour la recherche (codes ISO 2 lettres sÃ©parÃ©s par des virgules)  
		, PostCode: localite                                     	// Code postal pour lancer une recherche par dÃ©faut  
		, ColLivMod: "24R"                                      // Permet de filtrer les Points Relais selon le mode de livraison utilisÃ© (Standard [24R], XL [24L], XXL [24X], Drive [DRI])  
		, DisplayMapInfo: true                                  // Active ou non l'affichage d'une popup sur la carte avec les informations du point relais  
		,OnNoResultReturned:                                   // Fonction de callback dÃ©clenchÃ©e lorsqu'aucun rÃ©sultat n'est retournÃ© pour le code postal recherchÃ© par l'utilisateur 
			function () {                                     
				alert("Aucun rÃ©sultat n'a Ã©tÃ© retournÃ©")  
			}  
		, OnParcelShopSelected:                                 // Permet l'appel d'une fonction lors de la selection d'un Point Relais  
			function (data) {                                   // ImplÃ©mentation de la fonction de traitement, le paramÃ¨tre Data contient un objet avec les informations du Point Relais  
				
				var Adresses = (data.Adresse2 != null) ? data.Adresse1 + ' ' + data.Adresse2 : data.Adresse1;
				// Remplace les donnÃ©es de la balise ayant l'Id "cb_ID" par le contenu html de data.ID  
				// "data" est le paramÃ¨tre reÃ§u par la fonction, sont contenu est inconnu Ã  la compilation  
				// "ID" est contenu dans "data", il pourrait y avoir une erreur si "ID" n'existe pas dans la variable "data" reÃ§ue en paramÃ¨tre  
				
				$('input[name="MR_id"]').val(data.ID);
	            $('input[name="MR_nom"]').val(data.Nom);
	            $('input[name="MR_addres"]').val(data.Adresse1);
	            $('input[name="MR_cp"]').val(data.CP);
	            $('input[name="MR_ville"]').val(data.Ville);
	            $('input[name="MR_pays"]').val(data.Pays);
			}    
	});

	$('#select').on('click',function(e){
		var myLocalhost = (window.location.host == 'localhost' || window.location.host == "127.0.0.1") ? true : false;
        //var _get = (_GET('s_confirmation','true') == 'modify') ? 's_confirmation=modify' : '';
        var _get = (_GET('s_confirmation','true') == 'modify') ? '/modify' : '';
        var id = ($('input[name="MR_id"]').val() == '') ? '' : $('input[name="MR_id"]').val();
        var nom = ($('input[name="MR_nom"]').val() == '') ? '' : $('input[name="MR_nom"]').val();
        var adresse = ($('input[name="MR_addres"]').val() == '') ? '' : $('input[name="MR_addres"]').val();
        var cp = ($('input[name="MR_cp"]').val() == '') ? '' : $('input[name="MR_cp"]').val();
        var ville = ($('input[name="MR_ville"]').val() == '') ? '' : $('input[name="MR_ville"]').val();
        var pays = ($('input[name="MR_pays"]').val() == '') ? '' : $('input[name="MR_pays"]').val();

        if(_GET('s_confirmation','true') == 'modify'){
        	
        	if(myLocalhost){

        		window.top.location.href = 'http://127.0.0.1/lightyourscents.be/fr/panier/step4/modify/mode=mondial_relay&s_confirmation=modify&street=&adresse='+adresse+'&shortkpid='+id+'&kpname='+nom+'&zip='+cp+'&city='+ville;

        	}else{

        		/*window.top.location.href = 'http://lightyourscents.be/fr/panier/step4/modify/mode=mondial_relay&s_confirmation=modify&street=&adresse='+adresse+'&shortkpid='+id+'&kpname='+nom+'&zip='+cp+'&city='+ville;*/
        		window.top.location.href = '/fr/panier/step4/modify/mode=mondial_relay&s_confirmation=modify&street=&adresse='+adresse+'&shortkpid='+id+'&kpname='+nom+'&zip='+cp+'&city='+ville;
        	}
            
        }else{

        	if(myLocalhost){

				window.top.location.href = 'http://127.0.0.1/lightyourscents.be/fr/panier/step4/mode=mondial_relay&street=&adresse='+adresse+'&shortkpid='+id+'&kpname='+nom+'&zip='+cp+'&city='+ville;

        	}else{

        		/*window.top.location.href = 'http://lightyourscents.be/fr/panier/step4/mode=mondial_relay&street=&adresse='+adresse+'&shortkpid='+id+'&kpname='+nom+'&zip='+cp+'&city='+ville;*/
        		window.top.location.href = '/fr/panier/step4/mode=mondial_relay&street=&adresse='+adresse+'&shortkpid='+id+'&kpname='+nom+'&zip='+cp+'&city='+ville;
        	}

        }
        
    })
}

function API_mondial(dest){

	$(dest).MR_ParcelShopPicker({  
		Target: "#Target_Widget"                                // Selecteur JQuery de l'Ã©lÃ©ment dans lequel sera renvoyÃ© l'ID du Point Relais sÃ©lectionnÃ© (gÃ©nÃ©ralement un champ input hidden)  
		, TargetDisplay: "#TargetDisplay_Widget"                // Selecteur JQuery de l'Ã©lÃ©ment dans lequel sera renvoyÃ© l'ID du Point Relais sÃ©lectionnÃ© (secondaire pour affichage)  
		, TargetDisplayInfoPR: "#TargetDisplayInfoPR_Widget"    // Selecteur JQuery de l'Ã©lÃ©ment dans lequel seront renvoyÃ© les coordonnÃ©es complÃ¨tes de la selection de l'utilisateur  
		, Brand: "BDTEST  "                                     // Le code client Mondial Relay  
																// Lorsqu'il est indiquÃ© "BDTEST  ", un message d'avertissement apprait pour avertir que ce sont les paramÃ¨tres de test qui sont utilisÃ©s  
		, Country: "BE"                                         // Code ISO 2 lettres du pays utilisÃ© pour la recherche  
		,AllowedCountries: "BE"                           // Liste des pays selectionnable par l'utilisateur pour la recherche (codes ISO 2 lettres sÃ©parÃ©s par des virgules)  
		, PostCode: "1090"                                     	// Code postal pour lancer une recherche par dÃ©faut  
		, ColLivMod: "24R"                                      // Permet de filtrer les Points Relais selon le mode de livraison utilisÃ© (Standard [24R], XL [24L], XXL [24X], Drive [DRI])  
		, DisplayMapInfo: true                                  // Active ou non l'affichage d'une popup sur la carte avec les informations du point relais  
		,OnNoResultReturned:                                   // Fonction de callback dÃ©clenchÃ©e lorsqu'aucun rÃ©sultat n'est retournÃ© pour le code postal recherchÃ© par l'utilisateur 
			function () {                                     
				alert("Aucun rÃ©sultat n'a Ã©tÃ© retournÃ©")  
			}  
		, OnParcelShopSelected:                                 // Permet l'appel d'une fonction lors de la selection d'un Point Relais  
			function (data) {                                   // ImplÃ©mentation de la fonction de traitement, le paramÃ¨tre Data contient un objet avec les informations du Point Relais  
				
				var Adresses = (data.Adresse2 != null) ? data.Adresse1 + ' ' + data.Adresse2 : data.Adresse1;
				// Remplace les donnÃ©es de la balise ayant l'Id "cb_ID" par le contenu html de data.ID  
				// "data" est le paramÃ¨tre reÃ§u par la fonction, sont contenu est inconnu Ã  la compilation  
				// "ID" est contenu dans "data", il pourrait y avoir une erreur si "ID" n'existe pas dans la variable "data" reÃ§ue en paramÃ¨tre  
				
				$("#cb_ID").html(data.ID);  
				$("#cb_Nom").html(data.Nom);  
				//$("#cb_Adresse").html(data.Adresse1 + ' ' + data.Adresse2);  
				$("#cb_Adresse").html(Adresses);  
				$("#cb_CP").html(data.CP);  
				$("#cb_Ville").html(data.Ville);  
				$("#cb_Pays").html(data.Pays);  
			}    
	});
}

function extractID(tabID){

	for (var i=0; i < tabID.length; i++) {

		var x = tabID[ i ].split(']');
		
	}

	return x[0];
}

function str_replace(search, replace, subject, count) {
	//  discuss at: http://phpjs.org/functions/str_replace/
	// original by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
	// improved by: Gabriel Paderni
	// improved by: Philip Peterson
	// improved by: Simon Willison (http://simonwillison.net)
	// improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
	// improved by: Onno Marsman
	// improved by: Brett Zamir (http://brett-zamir.me)
	//  revised by: Jonas Raoni Soares Silva (http://www.jsfromhell.com)
	// bugfixed by: Anton Ongson
	// bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
	// bugfixed by: Oleg Eremeev
	//    input by: Onno Marsman
	//    input by: Brett Zamir (http://brett-zamir.me)
	//    input by: Oleg Eremeev
	//        note: The count parameter must be passed as a string in order
	//        note: to find a global variable in which the result will be given
	//   example 1: str_replace(' ', '.', 'Kevin van Zonneveld');
	//   returns 1: 'Kevin.van.Zonneveld'
	//   example 2: str_replace(['{name}', 'l'], ['hello', 'm'], '{name}, lars');
	//   returns 2: 'hemmo, mars'

	var i = 0,
	j = 0,
	temp = '',
	repl = '',
	sl = 0,
	fl = 0,
	f = [].concat(search),
	r = [].concat(replace),
	s = subject,
	ra = Object.prototype.toString.call(r) === '[object Array]',
	sa = Object.prototype.toString.call(s) === '[object Array]';
	s = [].concat(s);
	
	if (count) {
		this.window[count] = 0;
	}

	for (i = 0, sl = s.length; i < sl; i++) {
		if (s[i] === '') {
		  continue;
		}
		for (j = 0, fl = f.length; j < fl; j++) {
		  temp = s[i] + '';
		  repl = ra ? (r[j] !== undefined ? r[j] : '') : r[0];
		  s[i] = (temp)
		    .split(f[j])
		    .join(repl);
		  if (count && s[i] !== temp) {
		    this.window[count] += (temp.length - s[i].length) / f[j].length;
		  }
		}
	}
	return sa ? s : s[0];
}

function _GET(paramFind,myIframe){

	var url = (myIframe == 'false') ? window.location.href : parent.frames.location.href;

	//var queryString = url.split("?");
	var queryString = url.split("&");

	if(queryString[1]){

		var params = queryString[1].split("&");

		for(var i = 0 ; i < params.length ; i++){
			var param = params[i].split("=");
			var paramKey = param[0];
			var paramValue = decodeURIComponent((param[1]).replace(/\+/g, " "));
			
			if(paramKey == paramFind){
				return paramValue;
			}
		}
	}
}

function addRow(key, value) {

	var table = document.getElementById("parameters");
	var rowCount = table.rows.length;
	var row = table.insertRow(rowCount);
	var cell1 = row.insertCell(0);
	var cell2 = row.insertCell(1);

	cell1.innerHTML = key;
	cell2.innerHTML = value;
}

function printParameters(){
	//document.getElementById('bckUrl').innerHTML = url;
	var url = window.location.href;
	var queryString = url.split("?");

	if(queryString[1]){
		
		var params = queryString[1].split("&");
		
		for(var i = 0 ; i < params.length ; i++){
			var param = params[i].split("=");
			var paramKey = param[0];
			var paramValue = decodeURIComponent((param[1]).replace(/\+/g, " "));
			addRow(paramKey, paramValue);
		}
	}
}